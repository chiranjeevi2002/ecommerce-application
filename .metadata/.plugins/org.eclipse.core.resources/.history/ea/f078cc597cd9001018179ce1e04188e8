package com.ecommerce.apigateway.controller;

import com.ecommerce.apigateway.constants.GatewayStatus;
import com.ecommerce.apigateway.constants.GatewayErrorCodes;
import com.ecommerce.apigateway.constants.GatewayMessages;
import com.ecommerce.apigateway.model.GatewayErrorResponse;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.UUID;

@RestController
@RequestMapping("/gateway-fallback")
public class GatewayFallbackController {

    @GetMapping("/{service}")
    public ResponseEntity<GatewayErrorResponse> fallback(@PathVariable String service) {

        String traceId = UUID.randomUUID().toString();

        GatewayErrorResponse response = new GatewayErrorResponse(
                service,
                GatewayStatus.DOWN,
                GatewayErrorCodes.SERVICE_UNAVAILABLE,
                GatewayMessages.SERVICE_UNAVAILABLE,
                traceId
        );

        return ResponseEntity
                .status(HttpStatus.SERVICE_UNAVAILABLE)
                .body(response);
    }

    @RequestMapping(path = "/{service}", method = {
            RequestMethod.POST,
            RequestMethod.PUT,
            RequestMethod.DELETE
    })
    public ResponseEntity<GatewayErrorResponse> fallbackAny(@PathVariable String service) {
        return fallback(service);
    }
}
